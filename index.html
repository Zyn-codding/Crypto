<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spin & Crypto Game</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; background: #111; color: #fff; }
    #login, #game { margin-top: 50px; }
    #wheel { width: 300px; height: 300px; border-radius: 50%; border: 10px solid #fff; margin: 20px auto; position: relative; overflow: hidden; }
    #wheel div { width: 50%; height: 50%; position: absolute; top: 50%; left: 50%; transform-origin: 0% 0%; background: #222; color: #fff; display:flex; align-items:center; justify-content:center; font-size:14px; }
    button { margin: 5px; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; background: #28a745; color: white; }
    #crypto { margin: 20px; }
    #shop { margin-top: 20px; }
    .hidden { display: none; }
  </style>
</head>
<body>

<div id="login">
  <h2>Login</h2>
  <input type="text" id="username" placeholder="Username"><br><br>
  <input type="password" id="password" placeholder="Password"><br><br>
  <button onclick="login()">Login</button>
  <p id="loginMessage"></p>
</div>

<div id="game" class="hidden">
  <h2>Welcome, <span id="userDisplay"></span></h2>
  <h3>Balance: $<span id="balance">0</span></h3>

  <!-- Spin -->
  <div id="wheel"></div>
  <button onclick="spin()">Spin</button>

  <!-- Crypto -->
  <div id="crypto">
    <h3>Crypto Price: $<span id="cryptoPrice">100</span></h3>
    <button onclick="buyCrypto()">Buy</button>
    <button onclick="sellCrypto()">Sell</button>
    <p id="cryptoStatus"></p>
  </div>

  <!-- Shop -->
  <div id="shop">
    <h3>Shop</h3>
    <button onclick="buyLucky('v1',10,30,5)">Lucky v1 ($10)</button>
    <button onclick="buyLucky('v2',20,50,15)">Lucky v2 ($20)</button>
    <button onclick="buyLucky('v3',35,75,30)">Lucky v3 ($35)</button>
    <button onclick="buyLucky('v4',50,90,50)">Lucky v4 ($50)</button>
    <button onclick="buyLucky('inf',550,100,0)">Lucky Inf ($550)</button>
    <p id="luckStatus">Luck: 0%</p>
  </div>
</div>

<script>
  const users = {
    "ACC_DEV": { password: "ZYN", balance: 1000 },
    "USER_123": { password: "user1", balance: 10 },
    "Anomaly1": { password: "Tung", balance: 10 }
  };

  let currentUser = null;
  let cryptoPrice = 100;
  let holdingCrypto = false;
  let luck = { percent: 0, expire: 0 }; // expire = timestamp

  function saveData() {
    if (!currentUser) return;
    localStorage.setItem(currentUser, JSON.stringify({
      balance: users[currentUser].balance,
      luck: luck,
      cryptoPrice: cryptoPrice,
      holdingCrypto: holdingCrypto
    }));
  }

  function loadData(username) {
    let data = localStorage.getItem(username);
    if (data) {
      let obj = JSON.parse(data);
      users[username].balance = obj.balance;
      luck = obj.luck;
      cryptoPrice = obj.cryptoPrice || 100;
      holdingCrypto = obj.holdingCrypto || false;
    }
  }

  function login() {
    const u = document.getElementById("username").value;
    const p = document.getElementById("password").value;
    if (users[u] && users[u].password === p) {
      currentUser = u;
      loadData(u);
      document.getElementById("login").classList.add("hidden");
      document.getElementById("game").classList.remove("hidden");
      document.getElementById("userDisplay").innerText = u;
      updateDisplay();
    } else {
      document.getElementById("loginMessage").innerText = "Invalid login";
    }
  }

  function updateDisplay() {
    document.getElementById("balance").innerText = users[currentUser].balance;
    document.getElementById("cryptoPrice").innerText = cryptoPrice;
    document.getElementById("luckStatus").innerText = `Luck: ${luck.percent}%`;
    saveData();
  }

  // Spin logic
  const prizes = [1,10,15,20,25,30,35,40,45,50,100];
  function spin() {
    let prize = prizes[Math.floor(Math.random()*prizes.length)];
    if (luck.percent > 0 && Math.random()*100 < luck.percent) {
      prize *= 2; // hoki dobel hadiah
    }
    users[currentUser].balance += prize;
    alert("You won $" + prize);
    updateDisplay();
  }

  // Crypto
  function buyCrypto() {
    if (!holdingCrypto) {
      holdingCrypto = true;
      document.getElementById("cryptoStatus").innerText = "You bought at $" + cryptoPrice;
    }
    updateDisplay();
  }

  function sellCrypto() {
    if (holdingCrypto) {
      let gain = cryptoPrice - 100;
      users[currentUser].balance += gain > 0 ? gain : 0;
      holdingCrypto = false;
      document.getElementById("cryptoStatus").innerText = "You sold for $" + cryptoPrice + " | Profit: $" + gain;
    }
    updateDisplay();
  }

  setInterval(()=>{
    // update crypto price
    let change = (Math.random() < (luck.percent/100)) ? 1 : (Math.random()<0.5?-1:1);
    cryptoPrice += change * Math.floor(Math.random()*5);
    if (cryptoPrice < 1) cryptoPrice = 1;

    // check luck expire
    if (luck.expire > 0 && Date.now() > luck.expire) {
      luck.percent = 0;
      luck.expire = 0;
    }
    updateDisplay();
  },2000);

  // Shop
  function buyLucky(type, cost, percent, minutes) {
    if (users[currentUser].balance >= cost) {
      users[currentUser].balance -= cost;
      luck.percent = percent;
      luck.expire = (minutes>0) ? Date.now() + minutes*60000 : 0;
      alert("You bought Lucky " + type + " ("+percent+"%)");
      updateDisplay();
    } else {
      alert("Not enough money!");
    }
  }
</script>
</body>
</html>
